@model List<Ecommerce.Entities.Product>
@{
    ViewBag.Title = "ProductsTable";
}

<h2>ProductsTable</h2>

<div>

    <form method="post">

        <input id="searchTxt" name="Search" />

        <button type="button" id="searchBtn">Search</button>

    </form>
    <button type="button" id="newBtn">New</button>

</div>

<div>
    <table>

        <thead>

            <!--Row tag-->
            <tr>

                <!--td is a cell-->
                <td>Product Name</td>
                <td>Category</td>
                <td>Price</td>
                <td>Action</td>

            </tr>

        </thead>

        <tbody>

            @foreach (var item in Model)
            {
                <tr>

                    <td>@item.Name</td>
                    <td>
                        @if (item.Category != null)
                        {
                            <text>@item.Category.Name</text> // show the category name as text, if we dont use text will get an error
                        }
                        else
                        {
                            <text>-</text>

                        }
                    </td>
                    <td>@item.Price</td>
                    <td>
                        <!--'id' attribute should not hold data, so we created our own elemtent attribute called 'data-id' and passed data of the items id-->
                        <button class="edtBtn" data-id="@item.ID" type="button">Edit</button>
                        <button class="deleteBtn" data-id="@item.ID" type="button">Delete</button>


                    </td>

                </tr>
            }

        </tbody>

    </table>
</div>


<script>

    // '$' Jquery reference
    // '#' is used for ids and '.' is used for classes
    $("#searchBtn").click(function () {

        var searchTxt = $("#searchTxt").val();

        $.ajax({

            method: "GET", // By default the method is always 'GET'
            url: "/Product/ProductsTable", // Were going to pass data to the 'ProductsTable' action
            data: { search: searchTxt } // 'search' is the exact paremeter name of the 'ProductsTable' action and we are passing the 'searchTxt' to it

        })
            .done(function (response) { // the response returns an html with values

                // so set vales from the response which comes in the form of html with its values to the 'tableDiv' html
                $("#tableDiv").html(response);
            })
            .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                alert("Fail");
            });
    });

     $("#newBtn").click(function () {


        $.ajax({

            method: "GET", // By default the method is always 'GET'
            url: "/Product/Create", 

        })
            .done(function (response) { // the response returns an html with values

                // so set vales from the response which comes in the form of html with its values to the 'tableDiv' html
                $("#actionContainer").html(response);
            })
             .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                 alert("Fail");
             });
     });

    $(".edtBtn").click(function () {


        $.ajax({

            method: "GET", // By default the method is always 'GET'
            url: "/Product/Edit",
            data: { id: $(this).attr("data-id") } // which ever button is clicked get that buttons value from its attribute called 'data-id"'

        })
            .done(function (response) { // the response returns an html with values

                // so set vales from the response which comes in the form of html with its values to the 'tableDiv' html
                $("#actionContainer").html(response);
            })
            .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                alert("Fail");
            });
    });

        $(".deleteBtn").click(function () {

            var confirmToDelete = confirm("Are you sure you want to delete"); // create a confirm message to the user

            if (confirmToDelete) { // if user clicks yes
                $.ajax({

                    method: "POST", 
                    url: "/Product/Delete",
                    data: { id: $(this).attr("data-id") } // which ever button is clicked get that buttons value from its attribute called 'data-id"'

                })
                    .done(function (response) { // the response returns an html with values

                        // so set vales from the response which comes in the form of html with its values to the 'tableDiv' html
                        $("#tableDiv").html(response);
                    })
                    .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                        alert("Fail");
                    });
            }


        });





</script>